---
title: Compilation System
sidebar:
  order: 2
---

Detailed walkthrough of each compilation phase. For high-level overview, see [Architecture](/pencel/internals/architecture/).

**⚠️ Note:** This describes intended architecture. See [TODOs](/pencel/internals/todos/) for implementation status.

## Phases

### 1. Discover ✅
Validates `tsconfig.json` and globs for input files matching the config pattern.

### 2. Load ✅
Reads files from disk and creates TypeScript `SourceFile` objects.

### 3. Build IR ✅
Parses decorators and metadata into an immutable IR (component, prop, event definitions).

### 4. Sync AST ⚠️
Updates AST nodes to reflect IR state. Resolves cross-file dependencies.

### 5. Generate ⚠️
Runs generators (always fully rebuild from complete IR). Examples: `ir.json`, `components.d.ts`.

### 6. Derive ⚠️
Runs derivatives (per-source framework adapters). Examples: `component.react.tsx`, `component.angular.ts`.

### 7. Write ⚠️
Flushes all generated files to disk.

## File Organization

```typescript
sourceFiles.loadSource()        // Project source files
sourceFiles.clearGenerated()    // Clear last pass's generated files
sourceFiles.newFile(name)       // Create a generated file
```

**Project source files** are user-written components. **Generated files** are created each pass by generators and derivatives. Clear distinction prevents stale outputs.

## Plugin Hooks

Plugins listen for hooks using the `handle()` method. See [Core Components](/pencel/internals/core/) for orchestration details.

**⚠️ Status:** Hook interfaces are evolving.
