---
title: File and Dependency Management
sidebar:
  order: 5
---

How Pencel manages source files, generated files, and import resolution during compilation.

## File Organization

The compiler maintains three categories of files:

```typescript
sourceFiles.loadSource()        // Project source files
sourceFiles.clearGenerated()    // Clear last pass's generated files
sourceFiles.newFile(name)       // Create a generated file
```

**Project source files** are user-written components, persisted across compilation passes and updated by transformers. **Generated files** are created each pass by generators and derivatives, cleared at startup to prevent stale outputs.

## SourceFiles Registry

The `SourceFiles` class manages all files and serves as the central registry:

- **`loadSource()`** – Reads `.pen.tsx` files from disk and creates TypeScript `SourceFile` objects
- **`newFile(fileName)`** – Creates a generated file (auto-registers for tracking)
- **`setStatements(sourceFile, statements)`** – Updates a file's AST statements
- **`getAll()`** – Returns combined map of project + generated files
- **`getSourceFile(filePath)`** – Retrieves a specific file by path

Generated files are automatically registered, ensuring clear separation between user code and compiler output.

## Writing Files to Disk

The `FileWriter` orchestrates final output:

1. Runs all **generators** (global file plugins) with complete IR tree
2. Calls `SourcePrinter.printFile()` for each file (AST → source code)
3. Formats output using Biome
4. Writes to disk with Pencel marker

The `SourcePrinter` adds a marker comment to generated files for identification.

## Source Code Printing

The `SourcePrinter` converts TypeScript AST back to source code:

- Uses `ts.createPrinter()` to emit AST
- Adds Pencel marker comment (identifies generated files)
- Formats with Biome
- Preserves comments (non-JSDoc)

## Import Symbol Resolution

⚠️ **Not yet implemented.** When available, this will:

- Validate import paths across files
- Resolve type references between components
- Ensure all symbols are properly exported
- Handle cross-file dependency tracking

This enables the **Sync AST** phase to correctly resolve and inject type definitions, making component metadata complete before generation.
