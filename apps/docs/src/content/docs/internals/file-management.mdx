---
title: File Management
sidebar:
  order: 6
---

import { Aside } from '@astrojs/starlight/components';

Pencel maintains separate registries for source files (user-written) and generated files (compiler-created).

## File Organization

```typescript
sourceFiles.loadSource()        // Load *.pen.tsx files
sourceFiles.clearGenerated()    // Clear stale outputs
sourceFiles.newFile(name)       // Create generated file
sourceFiles.getAll()            // Get source + generated
```

**Project source files** persist across passes. **Generated files** are cleared at startup.

## SourceFiles Registry

Central file registry for all files in compilation:

- **`loadSource()`** – Read `.pen.tsx` files, create TypeScript AST
- **`newFile(fileName)`** – Create generated file (auto-registered)
- **`setStatements(sourceFile, statements)`** – Update AST statements
- **`getAll()`** – Combined map of all files
- **`getSourceFile(filePath)`** – Get specific file

## Write Phase

The `FileWriter` performs preprocessing then output:

```mermaid
graph LR
    A["Preprocess<br/>collect symbols"] --> B["Print<br/>AST → code"]
    B --> C["Postprocess"] --> D["Write"]
    
    style A fill:#ef5350,stroke:#c62828,color:#fff
    style B fill:#42a5f5,stroke:#1565c0,color:#fff
    style C fill:#42a5f5,stroke:#1565c0,color:#fff
    style D fill:#66bb6a,stroke:#2e7d32,color:#fff
```

<Aside type="tip">
Preprocessing runs before printing to ensure all symbol imports are in place before converting AST to code.
</Aside>

See [Symbol Resolution](/pencel/internals/preprocessing/) for import injection details.
