---
title: Render Transformer
sidebar:
  order: 8
---

Converts JSX render methods into zero-DOM factory function calls for efficient reconciliation:

```typescript
// Input JSX
render() { return <div class="btn">{this.label}</div>; }

// Output: factory calls with memoization
render() {
  let $0 = this.#cmc("div_0", () => dce("div"));
  sp($0, { class: "btn" });
  sc($0, [this.label]);
  sc(this, [$0]);
}
```

**Factory functions:**
- `dce(tag)` – Create element
- `dctn(text)` – Create text node
- `sp(el, props)` – Set properties
- `sc(parent, children)` – Set children with reconciliation
- `ael(el, event, handler)` – Add event listener
- `mc()` – Memoization cache

## Architecture

- **`render.ts`** – AST traversal orchestrator
- **`render.jsx.ts`** – JSX-to-factory transformation
- **`render.loop.ts`** – Loop nesting and scope key building

**Memoization Keys** – Nested loops use hierarchical keys to prevent collisions (`"li_4_" + id`, `"span_2_index_index1" + id`).

## Zero-DOM Function Binding

All factory functions accept `this: ComponentInterfaceWithContext` for component context:

```typescript
sp.call(this, element, { class: "btn" });    // Set property
sc.call(this, parent, [child1, child2]);     // Set children
st.call(this, textNode, "value");            // Set text
ael.call(this, element, "click", handler);   // Add listener
```

## Light-DOM Slot Projection

For non-shadow components, slots are projected with fallback logic:

```typescript
const lightDOMState = getLightDOMState(this);
const $slot = dce("slot");
sc(this, lightDOMState ? projectSlot($slot, this) : [$slot]);
```

**Filtering:** Default slot includes text/element nodes without `slot` attribute. Elements with `slot` attribute are excluded (reserved for named slots in Phase 2).

## Debugging

| Issue | Cause | Fix |
|-------|-------|-----|
| Double creation | Statements bubble to parent | Wrap in block inside callback |
| Missing index | Index not in key | Check "index" presence in keys |
| Incorrect cache keys | Hierarchical scope missing | Verify scope key joins all stack entries |
| Slots not projecting | Light-DOM state not initialized | Verify `prepareLightDOMSlots()` in lifecycle |

