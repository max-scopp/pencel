---
title: Understanding Pencel's Compiler
sidebar:
  order: 1.5
---

A conceptual overview of Pencel's three-layer architecture: semantic, synchronization, and translation.

## The Core Insight

A single `.pen.tsx` component should work in React, Angular, Vue, and vanilla JS—all from one source. Pencel separates concerns into three layers to make this efficient.

## Three Layers

### 1. Semantic Layer

The IR captures what the user wrote—format-agnostic metadata:

```typescript
{
  tag: 'my-button',
  props: [{ name: 'label', type: 'string' }],
  events: [{ name: 'onClick' }]
}
```

See [Architecture](/pencel/internals/architecture/) for the 7-phase compilation pipeline.

### 2. Synchronization Layer

AST nodes sync with IR via [IRRef](/pencel/internals/irri/). **Transformers** use IR as the single source of truth to update AST.

### 3. Translation Layer

Two types of outputs from IR:

- **Generators** – Global files (ir.json, components.d.ts). Always fully rebuild from complete IR.
- **Derivatives** – Framework adapters (React, Angular, Vue). One per source file, incremental.
- **Render Transformer** – Converts JSX render methods into zero-DOM factory function calls, optimizing component rendering.

See [Architecture](/pencel/internals/architecture/) for pipeline phases, [Core Components](/pencel/internals/core/) for plugin hooks, and [Render Transformer](/pencel/internals/render-transformer/) for JSX compilation details.

## Mental Model

Pencel is a component translation engine that outputs multiple formats from a single IR:

```mermaid
graph LR
    Source["component.pen.tsx"]
    IR["FileIR"]
    Gen["component.gen.ts"]
    React["component.react.tsx"]
    Angular["component.angular.ts"]
    IRJson["ir.json"]
    Types["components.d.ts"]
    
    Source -->|parse| IR
    
    IR -->|normalize| Gen
    IR -->|derive| React
    IR -->|derive| Angular
    IR -->|generate| IRJson
    IR -->|generate| Types
    
    style Source fill:#b3e5fc,stroke:#0277bd,color:#000
    style IR fill:#fff59d,stroke:#fbc02d,stroke-width:3px,color:#000
    style Gen fill:#ffe0b2,stroke:#e65100,stroke-width:3px,color:#000
    style React fill:#c8e6c9,stroke:#388e3c,color:#000
    style Angular fill:#c8e6c9,stroke:#388e3c,color:#000
    style IRJson fill:#f8bbd0,stroke:#c2185b,color:#000
    style Types fill:#f8bbd0,stroke:#c2185b,color:#000
```

**`.gen.ts`** is the normalized source: inlined CSS, resolved URLs, extended implementation.

## File Management

As files are generated/derived, Pencel manages imports via **SourceFiles**. See [File and Dependency Management](/pencel/internals/file-management/) for details.
